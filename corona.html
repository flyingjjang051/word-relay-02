<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>corona</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/fancybox.css" />
    <link rel="stylesheet" href="css/lightpick.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/corona.css" />
    <script src="https://kit.fontawesome.com/08ebc00fc6.js" crossorigin="anonymous"></script>
    <script src="js/gsap/gsap.min.js"></script>
    <script src="js/gsap/ScrollToPlugin.min.js"></script>
    <script src="js/splitting.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/hangul-tools.js"></script>
    <script src="js/fancybox.umd.js"></script>
    <script src="js/jquery-3.6.1.min.js"></script>
    <script src="js/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="js/lightpick.js"></script>
  </head>
  <body>
    <header id="header">
      <h1>corona</h1>
    </header>
    <div class="search">
      <input type="text" id="date" />
    </div>
    <div class="result">
      <div class="loading">corona data receiving</div>
      <canvas id="coronaChart"></canvas>
    </div>
    <script>
      // $.ajax({
      //   url: "http://apis.data.go.kr/1352000/ODMS_COVID_04/callCovid04Api?serviceKey=Wnus4QpirWGI56CfvzMWDIDHMRL%2FmEF%2FqTl9gwVNbRggLYTGPFIdwBy0L51B%2B27d5QRbLanNmIAxPwNvl7dKPA%3D%3D&api_type=json&std_day=2022-11-13",
      // })

      const picker = new Lightpick({ field: document.querySelector("#date") });

      const cities = [];
      const incDecList = [];
      const bgColorList = [];
      const borderColorList = [];
      $.ajax({
        url: "http://apis.data.go.kr/1352000/ODMS_COVID_04/callCovid04Api",
        data: {
          serviceKey: "Wnus4QpirWGI56CfvzMWDIDHMRL/mEF/qTl9gwVNbRggLYTGPFIdwBy0L51B+27d5QRbLanNmIAxPwNvl7dKPA==",
          api_type: "xml",
          std_day: "2022-11-13",
        },
        dataType: "xml",
      })
        .done(function (response) {
          const list = $(response).find("item");
          console.log($(list[0]).find("gubun").text());
          console.log($(list[1]).find("gubun").text());
          console.log(list.length);
          // for (let i = 0; i < list.length; i++) {
          //   console.log($(list[i]).find("gubun").text());
          // }
          // iterable
          $.each(list, function (idx, item) {
            cities.push($(item).find("gubun").text());
            incDecList.push($(item).find("incDec").text());
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            bgColorList.push(`rgba(${r}, ${g}, ${b}, 0.2)`);
            borderColorList.push(`rgba(${r}, ${g}, ${b}, 1)`);
          });
          //0~1  === 0.000183,0.14839482,0.7849389243,0.3484938824
          const myChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: cities,
              datasets: [
                {
                  label: "# of Votes",
                  data: incDecList,
                  backgroundColor: bgColorList,
                  borderColor: borderColorList,
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
          $(".loading").addClass("off");
        })
        .fail(function (error) {
          console.log(error);
        });
      console.log("end");

      const ctx = document.querySelector("#coronaChart").getContext("2d");
      //const ctx = $("#coronaChart").get(0).getContext("2d");
      //console.log(document.querySelector("#coronaChart"));
      //console.log($("#coronaChart").get(0) === document.querySelector("#coronaChart"));
    </script>
  </body>
</html>
